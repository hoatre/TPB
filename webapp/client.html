<html>
  <head>

    <title>Heart Beat Dashboard</title>
   
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="http://github.com/joewalnes/smoothie/raw/master/smoothie.js"></script>
    <script type="text/javascript" src="canvasjs.min.js"></script>

    <script type="text/javascript">

      var socket = io.connect('http://localhost:3000/');

      socket.on('connect', function(data){
        setStatus('connected');
        socket.emit('subscribe-1', {channel:'real-time-Branch 1'});
          socket.emit('subscribe-2', {channel:'real-time-Branch 2'});
          socket.emit('subscribe-3', {channel:'real-time-Branch 3'});
          socket.emit('subscribe-4', {channel:'real-time-Contact Center'});
          
          //minutes

          socket.emit('subscribe-5', {channel:'real-time-minutes-Branch 1'});
          socket.emit('subscribe-6', {channel:'real-time-minutes-Branch 2'});
          socket.emit('subscribe-7', {channel:'real-time-minutes-Branch 3'});
          socket.emit('subscribe-8', {channel:'real-time-minutes-Contact Center'});
      });

      socket.on('reconnecting', function(data){
        setStatus('reconnecting');
      });

      socket.on('message', function (channel, data) {
        console.log('received a message: ', data);
          switch(channel) {
              case 'real-time-Branch 1':
                  line1.append(new Date().getTime(), data);
                  break;
              case 'real-time-Branch 2':
                  line2.append(new Date().getTime(), data);
                  break;
              case 'real-time-Branch 3':
                  line3.append(new Date().getTime(), data);
                  break;
              case 'real-time-Contact Center':
                  line4.append(new Date().getTime(), data);
                  break;
              case 'real-time-minutes-Branch 1':
                  line5.append(new Date().getTime(), data);
                  break;
              case 'real-time-minutes-Branch 2':
                  line6.append(new Date().getTime(), data);
                  break;
              case 'real-time-minutes-Branch 3':
                  line7.append(new Date().getTime(), data);
                  break;
              case 'real-time-minutes-Contact Center':
                  line8.append(new Date().getTime(), data);
                  break;
              default:
                    break;
          }

        createTimeline();
        //addMessage(data);
      });

      function addMessage(data) {
          $('#online').html(data);
      }

      // Randomly add a data point every 500ms
      var random = new TimeSeries();
      // Data
      var line1 = new TimeSeries();
      var line2 = new TimeSeries();
      var line3 = new TimeSeries();
      var line4 = new TimeSeries();
      
      //minutes

      var line5 = new TimeSeries();
      var line6 = new TimeSeries();
      var line7 = new TimeSeries();
      var line8 = new TimeSeries();
      //var chartCD =  [2, 0, 4, 2, 5, 6, 7, 8, 4, 2, 0, 8];
      setInterval(function() {
          var socket = io.connect();

          socket.on('connect',function(data){
              //line1.append(new Date().getTime(), data);
              //line2.append(new Date().getTime(), data);
              //line3.append(new Date().getTime(), data);
              //line4.append(new Date().getTime(), data);
              createTimeline();
          });

      }, 1000);

      function myYRangeFunction(range) {
          // TODO implement your calculation using range.min and range.max
          var min = 0;
          var max = 10;
          return {min: min, max: max};
      }
      function createTimeline() {
          var chart = new SmoothieChart();
          var chartminutes = new SmoothieChart();
//          var ctx = document.getElementById("ChartCD").getContext("2d");
//          var chartCD = new Chart(ctx).Line(data, options);
          //var chartCD = new SmoothieChart();

          chart.addTimeSeries(line1,
                  { strokeStyle:'rgb(0, 255, 0)', fillStyle:'rgba(0, 255, 0, 0.4)', lineWidth:3 });
          chart.addTimeSeries(line2,
                  { strokeStyle:'rgb(255, 0, 255)', fillStyle:'rgba(255, 0, 255, 0.3)', lineWidth:3 });
          chart.addTimeSeries(line3,
                  { strokeStyle:'rgb(255, 255, 0)', fillStyle:'rgba(255, 255, 0, 0.4)', lineWidth:3 });
          chart.addTimeSeries(line4,
                  { strokeStyle:'rgb(0, 0, 255)', fillStyle:'rgba(0, 0, 255, 0.2)', lineWidth:3 });
          chart.streamTo(document.getElementById("chart"), 1000);

          //minutes
          chartminutes.addTimeSeries(line5,
                  { strokeStyle:'rgb(0, 255, 0)', fillStyle:'rgba(0, 255, 0, 0.4)', lineWidth:3 });
          chartminutes.addTimeSeries(line6,
                  { strokeStyle:'rgb(255, 0, 255)', fillStyle:'rgba(255, 0, 255, 0.3)', lineWidth:3 });
          chartminutes.addTimeSeries(line7,
                  { strokeStyle:'rgb(255, 255, 0)', fillStyle:'rgba(255, 255, 0, 0.4)', lineWidth:3 });
          chartminutes.addTimeSeries(line8,
                  { strokeStyle:'rgb(0, 0, 255)', fillStyle:'rgba(0, 0, 255, 0.2)', lineWidth:3 });
          chartminutes.streamTo(document.getElementById("chartminutes"), 5000);

          //chart co dinh
//          chartCD.addTimeSeries(line1,
//                  { strokeStyle:'rgb(0, 255, 0)', fillStyle:'rgba(0, 255, 0, 0.4)', lineWidth:3 });
//          chartCD.addTimeSeries(line2,
//                  { strokeStyle:'rgb(255, 0, 255)', fillStyle:'rgba(255, 0, 255, 0.3)', lineWidth:3 });
//          chartCD.addTimeSeries(line3,
//                  { strokeStyle:'rgb(255, 255, 0)', fillStyle:'rgba(255, 255, 0, 0.4)', lineWidth:3 });
//          chartCD.addTimeSeries(line4,
//                  { strokeStyle:'rgb(0, 0, 255)', fillStyle:'rgba(0, 0, 255, 0.2)', lineWidth:3 });
//          chartCD.streamTo(document.getElementById("chartCD"), 1000);
          createLineChart();
          //alert('1');
      }


      function setStatus(msg) {
          console.log('Connection Status : ' + msg);
      }
      function createLineChart() {
          var socket1 = io.connect('http://localhost:3000/');
              socket1.on('listChart',function(data1){
                  //alert(data1);
                  var array = $.map(data1, function(value, index) {
                      //alert(value);
                      return [value];
                  });

                  //var limit = 100000;    //increase number of dataPoints by increasing this

                  var y = 0;
                  var data = []; var dataSeries = { type: "line" };
                  var dataPoints = [];
                  for (var i = 0; i < array.length; i += 1) {
                      //alert(array[i]);
                      //y += 1;
                      dataPoints.push({
                          x: i + 1,
                          y: parseInt(array[i])
                      });
                  }
                  dataSeries.dataPoints = dataPoints;
                  data.push(dataSeries);


              var chartCD1 = new CanvasJS.Chart("chartCD",
                      {

                          data: data  // random generator below

                      });

              chartCD1.render();
              });

      }

    </script>
  </head>

  <body onload="createTimeline()">
  <table>
      <tr>
          <td>Total transactions in a second</td>
      </tr>
      <tr>
          <td>
          <canvas id="chart" width="1000px" height="200px"></canvas>
          </td>
      </tr>
      <tr>
          <td>Total transactions in 10 seconds</td>
      </tr>
      <tr>
          <td>
              <canvas id="chartminutes" width="1000px" height="200px"></canvas>
          </td>

      </tr>
      <tr>
          <td>chart co dinh</td>
      </tr>
      <tr>
          <td>
              <!--<canvas id="chartCD" width="1000px" height="200px"></canvas>-->
              <div id="chartCD" ></div>
          </td>

      </tr>
  </table>

  </body>
</html>

